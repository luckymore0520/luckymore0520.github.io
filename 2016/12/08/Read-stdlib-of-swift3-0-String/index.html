<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>




  <meta name="keywords" content="Hexo, NexT" />





  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />


<meta name="description" content="éƒ½è¯´ä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œæ ‡å‡†åº“çš„ä»£ç +æ³¨é‡ŠçœŸçš„æ˜¯æ¯”å®˜æ–¹æ–‡æ¡£è¿˜æœ‰ç”¨ï¼å…ˆæ‹¿æœ€å¸¸ç”¨çš„ String å¼€åˆ€ï¼">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”String">
<meta property="og:url" content="http://blog.luckymore.wang/2016/12/08/Read-stdlib-of-swift3-0-String/index.html">
<meta property="og:site_name" content="luckymoreçš„å­¦ä¹ ç¬”è®°">
<meta property="og:description" content="éƒ½è¯´ä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œæ ‡å‡†åº“çš„ä»£ç +æ³¨é‡ŠçœŸçš„æ˜¯æ¯”å®˜æ–¹æ–‡æ¡£è¿˜æœ‰ç”¨ï¼å…ˆæ‹¿æœ€å¸¸ç”¨çš„ String å¼€åˆ€ï¼">
<meta property="og:image" content="https://raw.githubusercontent.com/luckymore0520/Read-stdlib-of-Swift3.0/master/String.png">
<meta property="og:updated_time" content="2016-12-14T14:13:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”String">
<meta name="twitter:description" content="éƒ½è¯´ä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œæ ‡å‡†åº“çš„ä»£ç +æ³¨é‡ŠçœŸçš„æ˜¯æ¯”å®˜æ–¹æ–‡æ¡£è¿˜æœ‰ç”¨ï¼å…ˆæ‹¿æœ€å¸¸ç”¨çš„ String å¼€åˆ€ï¼">
<meta name="twitter:image" content="https://raw.githubusercontent.com/luckymore0520/Read-stdlib-of-Swift3.0/master/String.png">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>



  <title> Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”String | luckymoreçš„å­¦ä¹ ç¬”è®° </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">luckymoreçš„å­¦ä¹ ç¬”è®°</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”String
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            å‘è¡¨äº
            <time itemprop="dateCreated" datetime="2016-12-08T01:10:53+08:00" content="2016-12-08">
              2016-12-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; åˆ†ç±»äº
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOSå­¦ä¹ ç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">iOSå­¦ä¹ ç¬”è®°</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/08/Read-stdlib-of-swift3-0-String/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/08/Read-stdlib-of-swift3-0-String/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>éƒ½è¯´ä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£ï¼Œæ ‡å‡†åº“çš„ä»£ç +æ³¨é‡ŠçœŸçš„æ˜¯æ¯”å®˜æ–¹æ–‡æ¡£è¿˜æœ‰ç”¨ï¼<br>å…ˆæ‹¿æœ€å¸¸ç”¨çš„ <code>String</code> å¼€åˆ€ï¼</p>
<a id="more"></a> 
<p>é˜…è¯»è¿‡ç¨‹ä¸­å¯ä»¥é…åˆ playground æ–‡ä»¶ï¼š<a href="https://github.com/luckymore0520/Read-stdlib-of-Swift3.0/tree/master/String.playground" target="_blank" rel="external">String.playground</a> </p>
<h2 id="ç”¨æ³•ç®€ä»‹">ç”¨æ³•ç®€ä»‹</h2><p>Swift ä¸­çš„ String æ˜¯ä¸€ä¸ª Unicode çš„å­—ç¬¦ä¸²å€¼ï¼ˆstructï¼‰<br>Swift ä¸­çš„ String å¯ä»¥å’Œ Objective-C ä¸­çš„ <code>NSString</code> ç›¸äº’æ¡¥æ¥ï¼Œå¾ˆå¤šæ—¶å€™å°† <code>String</code> è½¬æ¢æˆ <code>NSString</code> æ¥åšä¸€äº›é’ˆå¯¹å­—ç¬¦ä¸²çš„å¤„ç†ä¼šæ›´åŠ æ–¹ä¾¿ã€‚<br>Swift ä¸­çš„ String è¿˜å¯ä»¥å¾ˆå®Œç¾åœ°å’Œ C å±‚è¿›è¡Œäº¤äº’ï¼Œå®ç°äº†ä¸€äº› C å±‚æ¬¡çš„ APIï¼Œå¹¶ä¸”ç»“æœå®Œå…¨ä¸€è‡´ã€‚</p>
<p>é¦–å…ˆå…ˆè®²è®² String çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼š</p>
<h3 id="åˆ›å»º">åˆ›å»º</h3><ul>
<li>string literals  å­—ç¬¦ä¸²æ„å»ºï¼Œæœ€ç®€å•çš„æ„å»ºæ–¹å¼  </li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> greeting = <span class="string">"Welcome!"</span></div></pre></td></tr></table></figure>
<ul>
<li>string interpolation æ’å€¼æ„å»º</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> name = <span class="string">"Rosa"</span></div><div class="line"><span class="keyword">let</span> personalizedGreeting = <span class="string">"Welcome, <span class="subst">\(name)</span>!"</span></div></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹">ä¿®æ”¹</h3><p>String ä¸ºå€¼ç±»å‹ï¼ˆstructï¼‰ï¼Œä¿®æ”¹ä¸€ä¸ª string çš„æ‹·è´ï¼ŒåŸæ¥çš„ä¸ä¼šè¢«å½±å“ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> otherGreeting = greeting</div><div class="line">otherGreeting += <span class="string">" Have a nice time!"</span></div><div class="line"><span class="built_in">print</span>(otherGreeting)</div><div class="line"><span class="comment">//Prints "Welcome! Have a nice time!"</span></div><div class="line"><span class="built_in">print</span>(greeting)</div><div class="line"><span class="comment">// Prints "Welcome!"  åŸæ¥çš„ä¸å—å½±å“</span></div></pre></td></tr></table></figure>
<h3 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h3><p>String æ¯”è¾ƒçš„ä¸æ˜¯å­—é¢å€¼ï¼Œè€Œæ˜¯æ ‡å‡†åŒ–ä¸º Unicode çš„å€¼</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> cafe1 = <span class="string">"Cafe\u&#123;301&#125;"</span></div><div class="line"><span class="keyword">let</span> cafe2 = <span class="string">"CafÃ©"</span></div><div class="line"><span class="built_in">print</span>(cafe1 == cafe2)</div><div class="line"><span class="comment">// Prints "true"  æœ€åçš„å€¼ä¸º true</span></div></pre></td></tr></table></figure>
<p>unicode <code>\u{301}</code> åšçš„å°±æ˜¯æŠŠå‰ä¸€ä¸ªå­—ç¬¦åšä¸€ä¸ªå‡è°ƒï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ç›¸ç­‰çš„ã€‚</p>
<h3 id="è§†å›¾">è§†å›¾</h3><p>String æœ¬èº«æ˜¯ä¸å¯è¿­ä»£çš„ï¼Œæ¯”å¦‚ä½ æ²¡æœ‰åŠæ³•ç›´æ¥æ‹¿åˆ° String çš„ lengthï¼Œéœ€è¦é€šè¿‡ String çš„è§†å›¾å®Œæˆé›†åˆç›¸å…³æ“ä½œã€‚</p>
<ul>
<li>Character View  å­—ç¬¦ä¸²è§†å›¾ </li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> cafe = <span class="string">"Cafe\u&#123;301&#125; du ğŸŒ"</span></div><div class="line"><span class="built_in">print</span>(cafe.characters.<span class="built_in">count</span>)</div><div class="line"><span class="comment">// Prints "9" æ³¨æ„ï¼Œ string.characters è¿”å›çš„æ˜¯ä¸€ä¸ª CharacterView ä¸æ˜¯ä¸€ä¸ª Array</span></div><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(cafe.characters))</div><div class="line"><span class="comment">// Prints "["C", "a", "f", "Ã©", " ", "d", "u", " ", "ğŸŒ"]"</span></div></pre></td></tr></table></figure>
<ul>
<li>Unicode ScalarView ï¼ˆUTF-32 View)</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span> (cafe.unicodeScalars.<span class="built_in">count</span>)  </div><div class="line"><span class="comment">// Print "10" </span></div><div class="line"><span class="built_in">print</span> (<span class="type">Array</span>(cafe.unicodeScalars))</div><div class="line"><span class="comment">// Prints "["C", "a", "f", "e", "\u&#123;0301&#125;", " ", "d", "u", " ", "\u&#123;0001F30D&#125;"]"</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(cafe.unicodeScalars.<span class="built_in">map</span> &#123; $<span class="number">0</span>.value &#125;)</div><div class="line"><span class="comment">//Prints "[67, 97, 102, 101, 769, 32, 100, 117, 32, 127757]"</span></div></pre></td></tr></table></figure>
<p>å·®åˆ«å¾ˆæ˜æ˜¾ï¼ŒCharacter View æ˜¯ç”¨æˆ·å¯è¯†åˆ«çš„ï¼Œé’ˆå¯¹ç”¨æˆ·çš„ï¼Œ Unicode ScalarView ç›´æ¥æ˜¾ç¤º UnicodeÂ·æ ‡é‡ï¼Œ <code>Ã©</code> ç”±ä¸¤ä¸ª Unicode ç»„æˆï¼Œæ‰€ä»¥å‰è€…ä¸º9 åè€…ä¸º 10ï¼Œ <code>ğŸŒ</code>  åœ¨ Unicode ScarlarView ä¸­ç›´æ¥æ˜¾ç¤ºä¸º 32ä½ çš„ Unicode å€¼</p>
<ul>
<li>UTF-16 View  </li>
</ul>
<p>ç›¸æ¯” Unicode ScalarView, UTF-16 æ˜¾ç¤ºçš„æ˜¯ 16ä½ çš„ Unicode </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(cafe.utf16.<span class="built_in">count</span>)</div><div class="line"><span class="comment">// Prints "11"</span></div><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(cafe.utf16))</div><div class="line"><span class="comment">// Prints "[67, 97, 102, 101, 769, 32, 100, 117, 32, 55356, 57101]"</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦  â€œğŸŒâ€ è¢«åˆ†å‰²æˆäº†ä¸¤ä¸ª UTF-16 å­—ç¬¦</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(<span class="string">"ğŸŒ"</span>.utf16))</div><div class="line"><span class="comment">//[55356, 57101]</span></div><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(<span class="string">"ğŸŒ"</span>.unicodeScalars))</div><div class="line"><span class="comment">//["\u&#123;0001F30D&#125;"]</span></div></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¹‹å‰æè¿‡ String å’Œ NSString ä¹‹é—´å¯ä»¥ç›´æ¥è¿›è¡Œæ¡¥æ¥ï¼Œé‚£ä¹ˆå°†åˆšæ‰é‚£ä¸ªå­—ç¬¦è½¬æ¢æˆ NSString åå†è°ƒç”¨å…¶ length ä¼šè·å¾—å¤šå¤§çš„é•¿åº¦å€¼å‘¢ï¼Ÿ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nscafe = cafe <span class="keyword">as</span> <span class="type">NSString</span></div><div class="line"><span class="built_in">print</span> (nscafe.length)</div><div class="line"><span class="comment">// Prints 11</span></div><div class="line"><span class="built_in">print</span>(nscafe.character(at: <span class="number">10</span>))</div><div class="line"><span class="comment">// Print  57101</span></div></pre></td></tr></table></figure>
<p>æ‰€ä»¥ NSString ç”¨çš„æ˜¯ UTF-16 çš„ç¼–ç æ–¹å¼</p>
<ul>
<li>UTF-8 View</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(cafe.utf8.<span class="built_in">count</span>)</div><div class="line"><span class="comment">//Prints "14"</span></div><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(cafe.utf8))</div><div class="line"><span class="comment">//240, 159, 140, 141]"</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> cLength = strlen(cafe)</div><div class="line"><span class="built_in">print</span>(cLength)</div><div class="line"><span class="comment">//Prints "14"</span></div></pre></td></tr></table></figure>
<p>strlen æ˜¯ C å±‚æ¬¡çš„ APIï¼Œ æ‰€ä»¥å¯ä»¥çœ‹åˆ° C ä¸­ String æ˜¯é‡‡å– UTF-8 ç¼–ç çš„</p>
<h2 id="è§†å›¾çš„é€‰æ‹©">è§†å›¾çš„é€‰æ‹©</h2><p>ä¸ºä»€ä¹ˆ Swift ä¸­ String è¦ä½¿ç”¨è§†å›¾ï¼Ÿ æˆ‘ä»¬é€‰æ‹©ä»€ä¹ˆæ ·çš„è§†å›¾å–å†³äºä½¿ç”¨çš„ç”¨é€”ã€‚ ä¸åŒçš„è§†å›¾å¯¼è‡´ String è¿”å›ä¸åŒçš„é•¿åº¦ã€‚<br>ä¸€ä¸ªæ˜¯ç”¨é€”è€ƒè™‘ï¼šç”¨äºç”¨æˆ·æ˜¾ç¤ºï¼Œé’ˆå¯¹ç”¨æˆ·è€Œè¨€ï¼Œè‚¯å®šæ˜¯ characterView<br>å¦ä¸€ä¸ªæ˜¯è€ƒè™‘å…¼å®¹ï¼š å¦‚æœéœ€è¦å’Œ C äº¤äº’ æˆ–è€…è½¬æ¢æˆäº† NSString ï¼Œåˆ™éœ€è¦å…·ä½“æƒ…å†µå…·ä½“è€ƒè™‘ã€‚</p>
<h2 id="IsEmpty">IsEmpty</h2><p>ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå¦‚æœæƒ³è¦åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œ ä¸è¦è°ƒç”¨ <code>views.count</code> ï¼Œè°ƒç”¨ <code>isEmpty</code> ï¼Œå‰è€…ä¼šæœ‰ä¸€ä¸ª O(n) çš„æ—¶é—´æ¶ˆè€—ï¼Œä¼šéå†ä¸€éã€‚</p>
<p>String çš„ isEmpty æ–¹æ³•ï¼Œç›´æ¥è®¿é—®äº† <code>_StringCore</code>çš„<code>countAndFlag</code>å±æ€§ï¼Œå¦‚æœä¸º 0 ï¼Œåˆ™ä¸ºç©ºã€‚<br>è€Œè°ƒç”¨ String.characters.countï¼Œ ä¼šå…ˆç”Ÿæˆä¸€ä¸ª CharacterViewï¼Œ ç„¶åå†å»è·å¾—é•¿åº¦ã€‚ å…·ä½“çœ‹ä¸‹æ–‡å¯ä»¥æ›´å¥½ç†è§£ã€‚</p>
<h2 id="String_å…ƒç´ è®¿é—®">String å…ƒç´ è®¿é—®</h2><p>æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç›´æ¥é€šè¿‡ cafe[i] æ¥è·å–åˆ° cafe çš„ç¬¬ i ä¸ªå…ƒç´ ï¼ˆ i ä¸ºä¸€ä¸ª Int ï¼‰ </p>
<p>å¿…é¡»ä½¿ç”¨ String.Index ä¸‹æ ‡  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> index = cafe.characters.index(cafe.startIndex, offsetBy: <span class="number">8</span>)</div><div class="line"><span class="built_in">print</span>(cafe[index])</div><div class="line"><span class="comment">//Print "ğŸŒ"</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥å¯¹ String åšä¸‹æ ‡è®¿é—®ï¼Œä½¿ç”¨çš„æ˜¯ CharacterView</p>
<p>å†çœ‹ä¸€ä¸ªå®˜æ–¹ä¾‹å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> name = <span class="string">"Marie Curie"</span></div><div class="line"><span class="keyword">let</span> firstSpace = name.characters.index(of: <span class="string">" "</span>)!</div><div class="line"><span class="keyword">let</span> firstName = <span class="type">String</span>(name.characters.<span class="keyword">prefix</span>(upTo: firstSpace))</div><div class="line"><span class="built_in">print</span>(firstName)</div><div class="line"><span class="comment">//Prints "Marie"</span></div></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>name.characters.index(of: &quot; &quot;)</code> è·å¾—ç¬¬ä¸€ä¸ªç©ºç™½å­—ç¬¦çš„ Indexï¼ˆç±»å‹ä¸º String.Indexï¼‰ï¼ŒString(characterView) å¯ä»¥å°† CharacterView è½¬æ¢æˆ Stringã€‚</p>
<p>Index æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨ CharacterView å’Œ UTF-8 Viewä¸­å¾ˆå¯èƒ½ä½ç½®ä¸åŒï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è¿›è¡Œè½¬æ¢ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> firstSpaceUTF8 = firstSpace.samePosition(<span class="keyword">in</span>: name.utf8)</div><div class="line"><span class="built_in">print</span>(<span class="type">Array</span>(name.utf8.<span class="keyword">prefix</span>(upTo: firstSpaceUTF8)))</div><div class="line"><span class="comment">//Prints "[77, 97, 114, 105, 101]"</span></div></pre></td></tr></table></figure>
<p>å…¶ä»– API å¯ä»¥é˜…è¯»å®˜æ–¹æ–‡æ¡£~ ä¸‹é¢è¿›å…¥æºç é˜¶æ®µï¼</p>
<h2 id="æºç é˜…è¯»">æºç é˜…è¯»</h2><h3 id="&lt;&lt;_struct_&gt;&gt;_String">&lt;&lt; struct &gt;&gt; String</h3><p>Stringçš„ç»“æ„ä½“æœ¬èº«éå¸¸ç®€å•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">String</span> </span>&#123;</div><div class="line">  <span class="comment">/// Creates an empty string.</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;</div><div class="line">    _core = _StringCore()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="comment">// @testable</span></div><div class="line">  <span class="keyword">init</span>(<span class="number">_</span> _core: _StringCore) &#123;</div><div class="line">    <span class="keyword">self</span>._core = _core</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="comment">// @testable</span></div><div class="line">  <span class="keyword">var</span> _core: _StringCore</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç€æ‰‹ç‚¹å°±åœ¨ _StringCore è¿™ä¸ªå¯¹è±¡ï¼Œ åœ¨ String æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ° <code>_StringCore</code> çš„å®šä¹‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯ String çš„ä¸€å¤§å †æ‰©å±•ï¼Œå…ˆä¸é’ˆå¯¹è¿™äº›æ‰©å±•åšæ–‡ç« ï¼Œæˆ‘ä»¬æ¥æ‰¾ <code>_StringCore</code></p>
<h3 id="&lt;&lt;_struct_&gt;&gt;__StringCore">&lt;&lt; struct &gt;&gt; _StringCore</h3><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾åˆ° StringCore çš„æ–‡ä»¶ï¼Œ åœ¨é‡Œé¢æœ‰ _StringCore å¯¹è±¡çš„å®šä¹‰ã€‚ _StringCore æ˜¯ä¸€ä¸ªæ¯”è¾ƒåº•å±‚çš„ç»“æ„ä½“ï¼ŒçœŸæ­£å®šä¹‰äº† String çš„æ•°æ®ç»“æ„ã€‚å®ƒèƒ½å¤Ÿå­˜å‚¨ ASCII å’Œ UTF-16ï¼Œ åŒæ—¶å¯ä»¥åŒ…è£… _StringBuffer æˆ–è€… NSString å®ä¾‹</p>
<p>_StringCore ä¸»è¦æœ‰ä¸‰ä¸ªå®ä¾‹ï¼š</p>
<p> <code>_baseAddress</code>,<code>_countAndFlags</code>,<code>_owner</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> s: <span class="type">String</span>? = <span class="string">"Foo"</span></div><div class="line"><span class="built_in">print</span>(s?.characters)</div><div class="line"><span class="comment">// Optional(Swift.String.CharacterView(_core: Swift._StringCore(_baseAddress: Optional(0x0000000111b220cc), _countAndFlags: 3, _owner: nil)))</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> t: <span class="type">String</span>? = <span class="string">"Foo"</span></div><div class="line"><span class="built_in">print</span>(t?.characters)</div><div class="line"></div><div class="line"><span class="comment">// Optional(Swift.String.CharacterView(_core: Swift._StringCore(_baseAddress: Optional(0x0000000111b220cc), _countAndFlags: 3, _owner: nil)))</span></div><div class="line"></div><div class="line">t = t! + <span class="string">" Hello"</span></div><div class="line"><span class="built_in">print</span>(t?.characters)</div><div class="line"><span class="comment">//Optional(Swift.String.CharacterView(_core: Swift._StringCore(_baseAddress: Optional(0x00006180000595b0), _countAndFlags: 9, _owner: Optional(Swift._HeapBufferStorage&lt;Swift._StringBufferIVars, Swift.UInt16&gt;))))</span></div><div class="line"><span class="built_in">print</span>(s?.characters)</div><div class="line"><span class="comment">//Optional(Swift.String.CharacterView(_core: Swift._StringCore(_baseAddress: Optional(0x00000001103ab0cc), _countAndFlags: 3, _owner: nil)))</span></div></pre></td></tr></table></figure>
<p>æ‰€ä»¥è‡³å°‘å¯ä»¥çœ‹åˆ° <code>_baseAddress</code>æŒ‡çš„æ˜¯ å­—ç¬¦ä¸²å¯¹åº”çš„åœ°å€æŒ‡é’ˆï¼Œ <code>_countAndFlags</code> ä»£è¡¨é•¿åº¦ , <code>owner</code>æš‚æ—¶ä¸çŸ¥é“å¹²å˜›çš„ =.= å¾…è®®ã€‚ä½†æ˜¯</p>
<p>è¿™é‡Œä¸¤ä¸ªStringå¯¹è±¡çš„ baseAddress æŒ‡å‘äº†åŒä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æœ‰å¿…è¦è§£é‡Šä¸‹ String çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p>
<p>åœ¨ Swift ä¸­ï¼Œ String ä½¿ç”¨çš„æ˜¯ copy-on-write çš„ç­–ç•¥å°†æ•°æ®å­˜å‚¨åœ¨ buffer ä¸­ï¼Œå¹¶ä¸” buffer æ˜¯å¯ä»¥å…±äº«çš„ï¼Œè¿™é‡Œçš„ä¸¤ä¸ªâ€Fooâ€å®é™…ä¸Šåº”è¯¥æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å·²ç»åšäº†ç›¸åº”çš„ä¼˜åŒ–ï¼Œä¸¤ä¸ª String æŒ‡å‘åŒä¸€å—å†…å­˜ã€‚</p>
<p>åœ¨ _StringCore è¿™ä¸ªæ–‡ä»¶ä¸­ï¼ŒåŒæ ·å®šä¹‰äº†è®¸å¤šæ–¹æ³•ï¼ŒåŒæ—¶ _StringCore ä¹Ÿå®ç°äº†ä¸å°‘åè®®ï¼Œè¿™äº›æˆ‘ä»¬å…ˆè·³è¿‡ï¼Œå› ä¸º _StringCore è¿™ä¸ªå¯¹è±¡åœ¨å®é™…å¼€å‘ä¸­åŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹åæ¶‰åŠåˆ° String çš„ä¸€äº›æ“ä½œçš„æ—¶å€™å›è¿‡å¤´çœ‹è¿™äº›æ–¹æ³•ã€‚</p>
<h3 id="&lt;&lt;_struct_&gt;&gt;_String-CharacterView">&lt;&lt; struct &gt;&gt; String.CharacterView</h3><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ String çš„ä¸åŒè§†å›¾ï¼Œ é¦–å…ˆæ˜¯æœ€å¸¸ç”¨åˆ°çš„ CharacterViewã€‚</p>
<p>String æœ¬èº«ä¸æ˜¯ä¸€ä¸ª Sequence æˆ–è€… Collectionï¼Œæ‰€ä»¥å¦‚æœè¦å¯¹ String ä¸­çš„å­—ç¬¦åšæ“ä½œï¼Œéœ€è¦å€ŸåŠ©å…¶è§†å›¾ï¼Œæ¯”å¦‚ characters</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">CharacterView</span> </span>&#123;</div><div class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> _core: _StringCore</div><div class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> _coreOffset: <span class="type">Int</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> text: <span class="type">String</span>) &#123;</div><div class="line">      <span class="keyword">self</span>._core = text._core</div><div class="line">      <span class="keyword">self</span>._coreOffset = <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="comment">// @testable</span></div><div class="line">    <span class="keyword">init</span>(<span class="number">_</span> _core: _StringCore, coreOffset: <span class="type">Int</span> = <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">self</span>._core = _core</div><div class="line">      <span class="keyword">self</span>._coreOffset = coreOffset</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> characters: <span class="type">CharacterView</span> &#123;</div><div class="line">    <span class="keyword">get</span> &#123;</div><div class="line">      <span class="keyword">return</span> <span class="type">CharacterView</span>(<span class="keyword">self</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">set</span> &#123;</div><div class="line">      <span class="keyword">self</span> = <span class="type">String</span>(newValue)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> characters: <span class="type">CharacterView</span>) &#123;</div><div class="line">    <span class="keyword">self</span>.<span class="keyword">init</span>(characters._core)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CharacterView æ˜¯ä¸€ä¸ª String çš„å†…éƒ¨ç»“æ„ä½“ï¼Œæœ‰ä¸¤ä¸ªç§æœ‰å±æ€§ï¼š <code>_core:_StringCore</code>,<code>_coreOffset: Int</code>ï¼Œ String å®šä¹‰äº†ä¸€ä¸ªè·å–å…¶ CharacterView çš„æ–¹æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº† <code>CharacterView(self)</code> å¯ä»¥çœ‹åˆ°ï¼Œ æ¯æ¬¡è°ƒç”¨ characters éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª CharacterViewï¼Œ è€Œ CharacterView çš„æ„é€ æ–¹æ³•å®é™…ä¸Šæ˜¯å¤åˆ¶äº† String çš„ _coreï¼Œ æ³¨æ„ï¼Œå› ä¸º _StringCore æ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯æ‹·è´ã€‚ è€Œ characters çš„ set æ–¹æ³•å®é™…ä¸Šæ›¿æ¢äº† String æœ¬èº«ã€‚</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸ªåœ¨è¿™ä¸ªç»“æ„ä½“å®šä¹‰çš„æ—¶å€™å”¯ä¸€æ¶‰åŠåˆ°çš„ä¸€ä¸ªåŠŸèƒ½æ€§è´¨çš„æ–¹æ³•</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">withMutableCharacters</span>&lt;R&gt;<span class="params">(</span></span></div><div class="line"><span class="number">_</span> body: <span class="params">(<span class="keyword">inout</span> CharacterView)</span> -&gt; <span class="type">R</span></div><div class="line">) -&gt; <span class="type">R</span> &#123;</div><div class="line"><span class="comment">// Naively mutating self.characters forces multiple references to</span></div><div class="line"><span class="comment">// exist at the point of mutation. Instead, temporarily move the</span></div><div class="line"><span class="comment">// core of this string into a CharacterView.</span></div><div class="line">	<span class="keyword">var</span> tmp = <span class="type">CharacterView</span>(<span class="string">""</span>)</div><div class="line">	<span class="built_in">swap</span>(&amp;_core, &amp;tmp._core)</div><div class="line">	<span class="keyword">let</span> r = body(&amp;tmp)</div><div class="line">	<span class="built_in">swap</span>(&amp;_core, &amp;tmp._core)</div><div class="line">	<span class="keyword">return</span> r</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„ CharacterView ä½œä¸º tmpï¼Œ äº¤æ¢ tmp å’Œ String çš„ _coreï¼Œ ç„¶åå¯¹ tmp åšä¸€äº›æ“ä½œï¼Œ åšå®Œä¹‹åå†äº¤æ¢å›æ¥ï¼Œ é‚£ä¹ˆ String çš„ _core å·²ç»æ˜¯è¢«å¤„ç†è¿‡çš„äº†ã€‚ å‡½æ•°è¿”å›çš„æ˜¯è¿™ä¸ªé—­åŒ…çš„è¿”å›å€¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">"All this happened, more or less."</span></div><div class="line"><span class="keyword">let</span> afterSpace = str.withMutableCharacters &#123; chars -&gt; <span class="type">String</span>.<span class="type">CharacterView</span> <span class="keyword">in</span></div><div class="line">	<span class="keyword">if</span> <span class="keyword">let</span> i = chars.index(of: <span class="string">" "</span>) &#123;</div><div class="line">  		<span class="keyword">let</span> result = chars.suffix(from: chars.index(after: i))</div><div class="line">		chars.removeSubrange(i..&lt;chars.endIndex)</div><div class="line">		<span class="keyword">return</span> result</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="type">String</span>.<span class="type">CharacterView</span>()</div><div class="line">  &#125;</div><div class="line"><span class="built_in">print</span>(str)</div><div class="line"><span class="comment">// Prints "All"</span></div><div class="line"><span class="built_in">print</span>(<span class="type">String</span>(afterSpace))</div><div class="line"><span class="comment">// Prints "this happened, more or less."</span></div></pre></td></tr></table></figure>
<p>ä¹‹å‰ä¹Ÿæè¿‡ï¼Œ String æœ¬èº«ä¸æ˜¯ä¸€ä¸ªé›†åˆä¸å¯è¢«éå†ï¼Œ è€Œ CharacterView å®ç°äº† <code>BidirectionalCollection</code> åè®®ï¼Œæ˜¯ä¸€ä¸ªé›†åˆï¼Œå¯éå†ã€‚</p>
<p>åœ¨å®ç°ä¸­ï¼Œ å®šä¹‰äº† String.CharacterView.Index è¿™ä¸ªå¯¹è±¡ï¼Œå³ CharacterView çš„ä¸‹æ ‡ï¼Œè¿™ä¸ªä¸‹æ ‡é¦–å…ˆæ˜¯ <code>Comparable</code> çš„ï¼Œè°ƒç”¨ CharacterView çš„ä¸‹æ ‡æ–¹æ³• <code>[]</code> ä¸­å¿…é¡»æ˜¯ä¸€ä¸ª <code>String.CharacterView.Index</code> å¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ª <code>Int</code> å€¼ã€‚</p>
<p><code>String.CharacterView.Index</code> æ˜¯åŸºäº <code>String.UnicodeScalarView.Index</code>çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªç±»å‹ä¸º <code>String.UnicodeScalarView.Index</code> çš„ base å®ä¾‹ï¼Œ é™„å¸¦ä¸€ä¸ª _countUTF16 çš„åç§»é‡ï¼Œ æˆ‘ä»¬å¯ä»¥ä»¥ä¹‹å‰çš„â€ğŸŒâ€ï¼Œå®ƒæ˜¯ä¸¤ä¸ª UTF-32 å­—ç¬¦ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ª Characterï¼Œæ‰€ä»¥ä¸€ä¸ª base å’Œä¸€ä¸ª count å°±å¯ä»¥è§£å†³ UnicodeScalarView.Index åˆ° CharacterView.Index çš„è½¬æ¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œ UnicodeScalarView.Index ä¸€å®šä¹Ÿæ˜¯é‡‡ç”¨äº†ç±»ä¼¼çš„è®¾è®¡ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä¸åŒè§†å›¾çš„ Index æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼Œä½¿ç”¨ <code>samePosition(in)</code> æ–¹æ³•ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> hearts = <span class="string">"Hearts &lt;3 â™¥ï¸ ğŸ’˜"</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> i = hearts.characters.index(of: <span class="string">" "</span>) &#123;</div><div class="line">	 <span class="keyword">let</span> j = i.samePosition(<span class="keyword">in</span>: hearts.utf8)</div><div class="line">	 <span class="built_in">print</span>(<span class="type">Array</span>(hearts.utf8.<span class="keyword">prefix</span>(upTo: j)))</div><div class="line">&#125;</div><div class="line"><span class="comment">// Prints "[72, 101, 97, 114, 116, 115]"</span></div></pre></td></tr></table></figure>
<p>è°ƒç”¨ CharacterView çš„ä¸‹æ ‡æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Character ç±»å‹çš„å¯¹è±¡ï¼Œ å¹¶ä¸”é€šè¿‡ UnicodeScalarsæ¥è¿›è¡Œæ„é€ çš„ã€‚ </p>
<p>å…³äº <code>Character</code> ç±»å‹ï¼Œ <code>Character</code> å¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ª Unicode ç»„æˆï¼Œ <code>Character</code> æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·çš„å­—ç¬¦ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œ ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå®ƒå®é™…ä¸Šç”±å¤šä¸ª Unicode å­—ç¬¦ç»„æˆã€‚</p>
<p><code>Character</code> æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå±æ€§æ˜¯ <code>_representation</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@_versioned</div><div class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">enum</span> <span class="title">Representation</span> </span>&#123;</div><div class="line"><span class="comment">// A _StringBuffer whose first grapheme cluster is self.</span></div><div class="line"><span class="comment">// <span class="doctag">NOTE:</span> may be more than 1 Character long.</span></div><div class="line"><span class="keyword">case</span> large(_StringBuffer._Storage)</div><div class="line"><span class="keyword">case</span> small(<span class="type">Builtin</span>.<span class="type">Int63</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€æœ‰çš„ UTF-8 å­—ç¬¦éƒ½å¯ä»¥ç”¨63ä½çš„Intæ¥è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹å°±æ˜¯ smallï¼Œ ä½†æ˜¯é UTF-8å°±ä¼šä½¿ç”¨ large(_StringBuffer._Storage) æ¥è¡¨ç¤ºï¼Œå®ƒå®Œå…¨æœ‰å¯èƒ½è¶…è¿‡ 1 ä¸ªå­—ç¬¦ã€‚</p>
<p>CharacterView åŒæ—¶è¿˜å®ç°äº†åè®® <code>RangeReplaceableCollection</code>, å¯ä»¥ä»å­—é¢ç†è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªä»£è¡¨ å¯ä»¥ä½¿ç”¨ Range æ¥æ›¿æ¢éƒ¨åˆ†çš„ Collectionï¼Œ æˆ‘ä»¬ä¸åšæ·±ç©¶ã€‚</p>
<p>é€šè¿‡é˜…è¯» CharacterView çš„æºç ï¼Œå¯ä»¥å‘ç°å‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯å€ŸåŠ©äº UnicodeScalarView æ¥åšçš„ï¼Œ å°±ä¸å¾—ä¸å»çœ‹çœ‹ UnicodeScalarView çš„å¯¹åº”æ“ä½œã€‚</p>
<h3 id="&lt;&lt;_struct_&gt;&gt;_String-UnicodeScalarView">&lt;&lt; struct &gt;&gt; String.UnicodeScalarView</h3><p>æˆ‘ä»¬å¯ä»¥çŒœæµ‹ UnicodeScalarView åº”è¯¥æ‹¥æœ‰å’Œ CharacterView ç±»ä¼¼çš„åŠŸèƒ½ï¼Œ æ˜¯ä¸€ä¸ª <code>BidirectionalCollection</code> å’Œä¸€ä¸ª  <code>RangeReplaceableCollection</code> ï¼Œæ‰“å¼€ StringUnicodeScalarView.swiftï¼Œ çš„ç¡®ï¼Œå®ƒå®ç°äº†è¿™ä¸¤ä¸ªåè®®ï¼Œè€Œä¸”å®ƒä¹ŸåŒæ ·æŒæœ‰ä¸€ä¸ªå’Œå¯¹åº” Stringç›¸åŒçš„_StringCoreï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å’Œæˆ‘çš„çŒœæµ‹æœ‰æ‰€å‡ºå…¥ã€‚</p>
<p>æˆ‘ä»¬åªè®²å®ƒå’Œ <code>String.CharacterView</code> ä¸åŒçš„åœ°æ–¹ï¼Œ ä»è¡¨ç°ä¸Šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ <code>UnicodeScalarView</code> ä»£è¡¨çš„æ˜¯ UTF-32ï¼Œ è€Œä¸€ä¸ª <code>Character</code> å¯èƒ½ç”±å¤šä¸ª <code>UTF-32</code> ç»„æˆã€‚</p>
<p>ä»å®ç°ä¸Šï¼Œ<code>CharacterView</code> çš„ç›¸å…³é›†åˆã€ä¸‹æ ‡æ“ä½œéƒ½æ˜¯ä¾èµ–äº <code>UnicodeScalarView</code> çš„ï¼Œ å¹¶ä¸”<code>CharacterView.Index</code>ä¹Ÿæ˜¯é€šè¿‡ <code>UnicodeScarlarView.Index</code> æ¥è¿›è¡Œç›¸å…³æ“ä½œï¼Œä½†æ˜¯ <code>UnicodeScalarView.Index</code> å¹¶ä¸æ˜¯æˆ‘æ‰€é¢„æƒ³çš„ä¾èµ–äº <code>UTF16View.Index</code>, è€Œæ˜¯ä¾èµ–äº _StringCoreã€‚</p>
<p><code>UnicodeScalarView.Index</code> ä»…æœ‰ä¸€ä¸ª Int ç±»å‹çš„å±æ€§ <code>_position</code> å³ä½ç½®ï¼Œè¿™ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºæ¯ä¸ª <code>UnicodeScalar</code> çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå³32ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªä½ç½®è¶³çŸ£ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸éœ€è¦ä¾èµ–äºå…¶ä»–çš„ <code>View</code>.</p>
<p><code>UnicodeScalarView</code> ä¸­å®šä¹‰äº†ä¸€ä¸ªè¿­ä»£å™¨ <code>_ScratchIterator</code> è´Ÿè´£å¯¹ <code>_core</code> è¿›è¡Œè¿­ä»£ï¼Œä»è€Œå®Œæˆ <code>UnicodeScalarView</code> çš„ä¸‹æ ‡æ“ä½œï¼Œ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¯¹äº _coreçš„ baseAddress åšå¯¹åº”çš„ä½æ“ä½œå°±å¯ä»¥è·å–åˆ°äº†ã€‚</p>
<p>åŒ<code>CharacterView</code>å’Œ<code>Character</code> ä¸€æ ·ï¼Œ <code>UnicodeScalarView</code> ä¹Ÿæœ‰è‡ªå·±çš„ <code>UnicodeScalar</code>ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª UTF-32ã€‚</p>
<p>åœ¨ StringUnicodeScalarView.swift ä¸­è¿˜å®šä¹‰äº†å…³äº UnicodeScalarView.Index å’Œå…¶ä»–è§†å›¾çš„ Index ç›¸äº’è½¬æ¢çš„æ‰©å±•æ–¹æ³•ã€‚</p>
<h3 id="å…¶ä»–è§†å›¾">å…¶ä»–è§†å›¾</h3><p><code>UTF16View</code> å’Œ <code>UnicodeScalarView</code> ç±»ä¼¼ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>_StringCore</code>æœ¬èº«æä¾›äº†ä¸‹æ ‡æ–¹æ³•è·å– UTF16.CodeUnitï¼Œè€Œå¹¶æ²¡æœ‰æ‰©å±•æ›´å¤šå…¶ä»–çš„ä¸‹æ ‡ï¼Œæ‰€ä»¥å¯¹äº <code>UTF16View</code>æ¥è¯´ï¼Œå¯ä»¥åŸºäº<code>_core</code>çš„ä¸‹æ ‡æ“ä½œæ¥å®Œæˆå¯¹åº”çš„é›†åˆç›¸å…³æ“ä½œã€‚</p>
<p><code>UTF8View</code> å¯¹ <code>_StringCore</code> è¿›è¡Œäº†æ‰©å±•ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>_UTF8Chunk</code>çš„åˆ«åï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªUInt64)ï¼Œå³ä¸€ä¸ª <code>UTF8</code> å—ï¼Œ <code>UTF8.Index</code>ä¸­é™¤äº†æœ‰ä¸€ä¸ª<code>Int</code>ç±»å‹çš„ coreIndex å¤–ï¼Œç›´æ¥å­˜äº†ä¸€ä¸ª <code>_UTF8Chunk</code> çš„ Buffer ï¼Œï¼ˆç´¢å¼•é‡Œç›´æ¥å­˜å€¼çœŸæ˜¯æœ‰åˆ›æ„ï¼Œä½†æ˜¯å¯¹äº UTF8 æ¥è¯´ä¼¼ä¹æ˜¯ä¸ªå¥½ä¸»æ„ï¼‰</p>
<h3 id="å…¶ä»–æ‰©å±•">å…¶ä»–æ‰©å±•</h3><ul>
<li>StringBridge å®šä¹‰äº†å’Œ NSString ä¹‹é—´çš„æ¡¥æ¥</li>
<li>StringComparable å®šä¹‰äº†é’ˆå¯¹ String çš„æ¯”è¾ƒæ–¹æ³•ï¼Œå¯ä»¥å‘ç°æ—¶åŸºäº ASCII ç çš„</li>
<li>StringHashable å®Œæˆäº† String çš„å“ˆå¸Œç­–ç•¥</li>
<li>StringIndexConversions å®šä¹‰äº† String ä¸åŒ View çš„ Index çš„ç›¸äº’è½¬æ¢</li>
<li>StringLegancy å®šä¹‰äº† String çš„ä¸€äº›æ‰©å±•æ–¹æ³•ï¼Œæ¯”å¦‚ hasPrefixã€hasSuffixã€repeatçš„åˆå§‹åŒ–æ–¹æ³•ç­‰ç­‰</li>
<li>ç­‰ç­‰ç­‰ç­‰</li>
</ul>
<h3 id="StringBuffer">StringBuffer</h3><p>å…³äº <code>StringBuffer</code>ï¼Œ å…¶å®è¿™å¯¹äºç†è§£ <code>String</code> çš„å†…å­˜ç®¡ç†æœºåˆ¶æ¯”è¾ƒé‡è¦ï¼Œç®€å•çœ‹äº†ä¸‹ï¼Œ <code>StringBuffer</code> ä¸»è¦æ˜¯ä¸€ä¸ªå±æ€§â€”â€”<code>_Storage</code> ï¼Œä»–æ˜¯ä¸€ä¸ª <code>HeapBuffer</code>ï¼Œ å…³äº <code>HeapBuffer</code>ï¼Œåˆæœ‰å¾ˆå¤šä¸œè¥¿è¦è®²ï¼Œæˆ‘å‡†å¤‡æ”¾åˆ°ä¸‹æ¬¡å†æ¥ç ”ç©¶ä¸‹ <code>StringBuffer</code></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2><p>å…ˆä¸Šä¸€å¼ å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/luckymore0520/Read-stdlib-of-Swift3.0/master/String.png" alt=""></p>
<p>å›¾ä¸­æè¿°äº† å…³äº String çš„ä¸€äº›æ¯”è¾ƒå…³é”®çš„å…³ç³»ï¼ŒåŒ…æ‹¬åè®®ã€ç»“æ„ä½“ï¼Œçœç•¥äº†ä¸€äº›å…¶ä»–çš„åè®®ï¼Œæ¯”å¦‚ Equatableï¼ŒComparable ç­‰ç­‰ï¼Œä¹Ÿçœç•¥äº†éƒ¨åˆ†è§†å›¾ï¼ˆUTF16ã€UTF8)ï¼ˆéƒ½ç”»ä¸Šè¦ä¹±å¥—äº†ï¼‰</p>
<p>é¦–å…ˆ <code>String</code> æ˜¯ä¸€ä¸ªç»“æ„éå¸¸ç®€å•çš„ç»“æ„ä½“ï¼ŒåªæŒæœ‰ä¸€ä¸ª <code>_StringCore</code> çš„ç»“æ„ä½“ï¼Œäºæ˜¯å…³äº <code>String</code> çš„æ‰€æœ‰å†…å®¹éƒ½å°è£…åœ¨ <code>_StringCore</code> ä¸Šï¼Œ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è®¾è®¡ï¼Œ<code>_StringCore</code> æ˜¯ä¸€ä¸ªç§æœ‰å¯¹è±¡ï¼Œç›´æ¥éš”ç¦»äº† <code>String</code> çš„æ‰€æœ‰å†…éƒ¨ç»“æ„ï¼ˆä½¿ç”¨è€…å¹¶ä¸å…³å¿ƒï¼‰ï¼Œè¿™æ ·æ—¢å®‰å…¨åˆæ–¹ä¾¿æ‰©å±•ã€‚</p>
<p><code>_StringCore</code> åŒ…å«ä¸‰ä¸ªå±æ€§ï¼Œ <code>_baseAddress</code> ï¼ˆ æŒ‡é’ˆåœ°å€ï¼ŒæŒ‡å‘å †ä¸­çš„ç›®æ ‡å­—ç¬¦ä¸²ï¼‰ <code>_countAndFlags</code>ï¼ˆå­—ç¬¦ä¸²é•¿åº¦ï¼‰, <code>_owner</code> ç”¨é€”ä½ç½®ï¼Œå¸Œæœ›åœ¨ä¸‹ä¸€æ¬¡çœ‹ <code>StringBuffer</code>çš„æ—¶å€™èƒ½å¤Ÿçœ‹å‡ºç«¯å€ªï¼Œç›®å‰çº¿ç´¢å°±æŒ‡å‘ <code>StringBuffer</code>ã€‚</p>
<p>å…³äº<code>String</code>çš„å†…å­˜å›æ”¶æœºåˆ¶ï¼šcopy-and-writeã€åŸºäºå †ï¼Œé‡å¤åˆ©ç”¨ã€‚ åœ¨ä¸‹ä¸€ç«  <code>StringBuffer</code> ä¸­åº”è¯¥ä¼šå¯¹è¿™å—æœºåˆ¶åšæ›´è¿›ä¸€æ­¥çš„äº†è§£ã€‚</p>
<p><code>String</code> è§†å›¾ï¼Œ <code>String</code> æœ‰ 4 ä¸ªè§†å›¾ï¼Œ <code>CharacterView</code> <code>UnicodeScalarView</code> <code>UTF16View</code> <code>UTF8View</code>ï¼Œ <code>String</code>å¹¶ä¸æŒæœ‰è§†å›¾ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ä¼šé‡æ–°åˆ›å»ºè§†å›¾ï¼ˆå¤åˆ¶_core)ï¼Œä¸åŒçš„è§†å›¾æ‹¥æœ‰å¯¹åº”ç±»å‹çš„ç´¢å¼•ï¼ˆIndexï¼‰ï¼Œç´¢å¼•ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ï¼Œ è§†å›¾æ˜¯ <code>Collection</code> å¯éå†ã€‚</p>
</span>
      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/21/Fix-Mac-Pro-Wifi/" rel="next" title="å¦‚ä½•å¤„ç† RMBP è›‹ç–¼çš„ Wi-Fi é—®é¢˜">
                <i class="fa fa-chevron-left"></i> å¦‚ä½•å¤„ç† RMBP è›‹ç–¼çš„ Wi-Fi é—®é¢˜
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/14/Read-stdlib-of-swift3-StringBuffer/" rel="prev" title="Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”ä» StringBuffer åˆ° String çš„å†…å­˜åˆæ¢">
                Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”ä» StringBuffer åˆ° String çš„å†…å­˜åˆæ¢ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2016/12/08/Read-stdlib-of-swift3-0-String/"
                   data-title="Swift 3.0 æ ‡å‡†åº“æºç é˜…è¯»ç¬”è®°â€”â€”String" data-url="http://blog.luckymore.wang/2016/12/08/Read-stdlib-of-swift3-0-String/">
              </div>
            
          </div>
        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://tva4.sinaimg.cn/crop.0.0.512.512.180/87939914jw8eus1v8o70mj20e80e80tc.jpg" alt="luckymore" itemprop="image"/>
          <p class="site-author-name" itemprop="name">luckymore</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/luckymore0520" target="_blank">
                  <i class="fa fa-github fa-fw"></i> GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2274597140/profile" target="_blank">
                  <i class="fa fa-weibo fa-fw"></i> Weibo
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">å‹æƒ…é“¾æ¥</p>
            
              <span class="links-of-author-item">
                <a href="http://blog.callmewhy.com/" target="_blank">CallMeWhy</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ios.dog/" target="_blank">Boolean93</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.zyliu.com/" target="_blank">Sheep</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.cee.moe/" target="_blank">Cee</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”¨æ³•ç®€ä»‹"><span class="nav-number">1.</span> <span class="nav-text">ç”¨æ³•ç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»º"><span class="nav-number">1.1.</span> <span class="nav-text">åˆ›å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¿®æ”¹"><span class="nav-number">1.2.</span> <span class="nav-text">ä¿®æ”¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¯”è¾ƒ"><span class="nav-number">1.3.</span> <span class="nav-text">æ¯”è¾ƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è§†å›¾"><span class="nav-number">1.4.</span> <span class="nav-text">è§†å›¾</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è§†å›¾çš„é€‰æ‹©"><span class="nav-number">2.</span> <span class="nav-text">è§†å›¾çš„é€‰æ‹©</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IsEmpty"><span class="nav-number">3.</span> <span class="nav-text">IsEmpty</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String_å…ƒç´ è®¿é—®"><span class="nav-number">4.</span> <span class="nav-text">String å…ƒç´ è®¿é—®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æºç é˜…è¯»"><span class="nav-number">5.</span> <span class="nav-text">æºç é˜…è¯»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#<<_struct_>>_String"><span class="nav-number">5.1.</span> <span class="nav-text"><< struct >> String</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#<<_struct_>>__StringCore"><span class="nav-number">5.2.</span> <span class="nav-text"><< struct >> _StringCore</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#<<_struct_>>_String-CharacterView"><span class="nav-number">5.3.</span> <span class="nav-text"><< struct >> String.CharacterView</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#<<_struct_>>_String-UnicodeScalarView"><span class="nav-number">5.4.</span> <span class="nav-text"><< struct >> String.UnicodeScalarView</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…¶ä»–è§†å›¾"><span class="nav-number">5.5.</span> <span class="nav-text">å…¶ä»–è§†å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…¶ä»–æ‰©å±•"><span class="nav-number">5.6.</span> <span class="nav-text">å…¶ä»–æ‰©å±•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StringBuffer"><span class="nav-number">5.7.</span> <span class="nav-text">StringBuffer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">6.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">luckymore</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="http://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"luckymore0520"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {

      isMobile() && FastClick.attach(document.body);

      // Define Motion Sequence.
      motionIntegrator
        .add(motionMiddleWares.logo)
        .add(motionMiddleWares.menu)
        .add(motionMiddleWares.backToTop)
        .add(motionMiddleWares.postList)
        .add(motionMiddleWares.sidebar);

      // Bootstrap Motion.
      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
